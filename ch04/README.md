# 區塊鏈原理 - 「區塊」鏈

## 為何要把資料「區塊」化？

用傳統資料庫技術儲存幾萬幾億筆就好，為什麼要區塊然後再廣播出去？

答案：交易區塊化，便於驗證

## 大綱

- Hash 函式的定義，還有他的用意是？
- Merkle Tree
- 區塊的組成到底是什麼？
- 交易的組成

## Hash 雜湊

- 類似一個黑盒子 (一個函數)
- 電腦任何文件丟進去就會產生一個固定長度但無法預期輸出的結果
- 差一點點的東西丟進去結果就會差非常多

### 特性

- 改變一點點輸入，產出會有巨大改變
  - 如果一樣就稱之為「碰撞」，等於這個 Hash 雜湊函數就不被信任
- 無法從「輸出結果」倒回到「輸入內容」
- 你無法找到不同輸入，得到同樣結果
- (簡單來說，一定要把同一部電影丟進去跑，才會有相同輸出，多一秒少一秒，都會有不同結果)
- SHA1 就是一種雜湊的方法，丟 bit 近來，字串出去

### 美國國家標準局發明認可安全的 Hash 函數

- MD5
- SHA-0
- SHA-1
- SHA-2 (比特幣目前採用：sha256)
- SHA-3 (又稱 Keccak)

其中 MD5、SHA-0、SHA-1 其實已經有人研發出有碰撞的可能

為何比特幣沒採用 SHA-3，因為 2008 年的時候 SHA-3 還沒有出來

之後遇到的應該都是 SHA-3 演算法，他不是美國國家標準局，它是去認可別人的演算法，全名為 Keccak

也不用怕 SHA256 產生碰撞，這樣的話比特幣基金會就會提出硬分叉的做法，改變共識規則。像 Monero 就在 2018/9 做一次升級，改變挖礦演算法，當初設定不可能有礦機，但還是有人發明出來，所以被開了硬分叉，礦機的概念其實就是把 hash 計算過程搬到硬體上面，但整個被換掉演算法，硬體就只能丟掉。

## 全班同學作弊案例？

- 把每一次答案的傳遞，想成是一個「區塊」，並把這些區塊加上「時間」、「數量」以及編號
- 但給他編號意義不大，只是不搞錯順序。會遇到答案偷改怎辦？總和還是 12、但答案被偷改，所以要用 hash 來解決問題，用 hash 來驗證這個區塊的答案集
- 並在創造下一個區塊時，把前一個區塊 hash 放一起再將時間、數量與答案一起 hash
- 這樣有人亂改答案，前一個 hash 就會不一樣

### 老師又開始變態了

- 一次考國英數自地，一次考三十種，一次發 30 張考卷
- 一個批次裡填答案就得變成多項，30 種
- 另一種儲存方式：Merkle Tree (哈希樹)
  - 一種資料的儲存與驗證的方式，在電腦科學中稱為：資料結構。是資料結構中的一種儲存方法
  - 國英數自地兩兩 hash ，往上層再兩兩 hash，最後得到一個 Root，也就是底下兩兩 hash 起來的，最後就會得到答案 hash (Merkle Tree Hash)
  - 資料簡化，儲存簡化，不然一個區塊會很肥，只要放這個簡化後的 hash，如果要驗證，就是把答案再堆疊起來做 hash
  - 區塊鏈比特幣，一個區塊會有幾百筆幾千筆交易，如果沒有用 Merkle Tree ，要驗證這筆交易有沒有在這個區塊的時候，就得全部資料擺進去 hash 做檢查，如果有用，就可以用相關區塊很快補足來檢查，達成方便做驗證的目的

## 區塊

- 可用 [Etherscan](https://etherscan.io/) 來查看一個 block 內容
- Etherscan 網站就是一個區塊鏈的瀏覽器，可以看到區塊上的資料
- 高度、時間、交易、Hash、父 Hash，還有其他毛
  - 可看到交易有幾筆 (e.g. 129 筆)
- Gas Used：使用量
  - 會因應使用量做自我調節，下一次要塞更多還是更少
- Gas Limit：總量
- 其他之後會講到
- Transactions (以下舉例)
  - 高度 6525175 (第 6525175 批次) 有 129 筆交易
  - 每一筆 Transaction
    - Hash
    - Parent Hash
    - From
    - To
    - Value (越低轉越快)
    - Gas Limit
    - Gas Used By Transaction: 21000 是固定
- 高度為零的區塊：創世 (Genesis) 區塊
  - Transactions 有 8893 個交易
    - 基金會當時採用 ICO (不確定)，用比特幣換以太幣，當時開放融資，所以一堆轉給他人以太幣的交易 (GENESIS -> 0x7c...)

### 創世區塊 (Genesis Block)

- 區塊鏈的第一個區塊由中本聰創建於 2009 年。也就是第 0 個區塊，有了它後續才能開始挖
- 中本聰在第 0 個區塊有動些手腳
  - 加入當天的報紙 (金融海嘯紓困案)，藉以告知比特幣是去中心化的，不受任何控制，不被金融機構 (華爾街) 的人玩弄，諷刺意味的放進去
  - 後續很多山寨幣也都會放當天頭條，證明這個區塊是當天所發生
  - 可在這裡看到 [BLOCKCHAIN](https://www.blockchain.com/)
- [Blockchain Demo](https://anders.com/blockchain/blockchain.html) 可從這裡做練習
  - Block
  - Nonce (挖礦相關)
  - Data
  - Prev
  - 以上這四個做一個 hash，所以只要改動上述一個值，會影響到後續的區塊
