# 區塊鏈原理 - 「挖礦」原理、難度

## 大綱

- Hash 新玩法
- 挖礦的真諦是什麼
- 礦工的獎勵
- 交易的一生機制
- 挖礦的難度

## Hash 新玩法

- 不同輸入、不同輸出
  - 有碰撞，這個 Hash 就不能用
- 驗證文件是否有被竄改、區塊的資料有沒有被修改

### 輸出是可預知還是不可預知？

- 不能反推
- 不能預測
- 只能猜測

### Hash 新玩法：猜數字

其實挖礦過程就是猜猜樂的過程！根據比特幣規定，只要猜到前面有 **00**，我們俗稱**前導 0**，就代表你**挖礦成功**！

隨高度越高，前導 0 就要求越多

Blockchain Demo 的 Block 頁籤，可以試挖

### Nonce 欄位？

- Nonce 的欄位代表你可以隨便擺數字，只要數字讓 block 的 hash 是有前導 0，這樣就成功了！
- 湊到一個可以合意的 Nonce 導致有挖到前導 0 的 Hash
- 由 Blockchain Demo 的 Mine 按鈕，會幫你從 0 -> 對的 Nonce 跑，挖到有前導 0 的 Hash 數字

## 挖礦

挖礦要電費、要主機，為何要幫你挖？

- 一個正常區塊裡除了有 Nonce 外，還有一個是 Coinbase
- Coinbase 是一個美公司名稱，另一個講法是它是這個區塊要獎勵的對象
- Coinbase 代表有獎勵，這獎勵給誰，正常是放人家的地址
- Tokens 就是 $、From、To 的集合 (原 Blockchain Demo 把 data 換掉)

### 挖礦的真諦

當礦工挖到比特幣 (猜對數字) 的同時，也表示已確認此區塊的高度，接著會公佈給所有節點，讓別人無法改變這個交易紀錄 (已被寫入在鏈上)。這正是「保護交易」的過程。而挖礦需要耗費電力，所以挖礦的真諦是：**倚靠電力 (成本) 保護交易**

- 以礦工立場：獲利
- 以送交易人的立場：保護交易
  - 區塊開越多，電費越高，但也更為安全，因為是鏈整個串起來
- 嘗試一個測試交易，在 Etherscan 觀看該交易
- Block Height 欄位
  - 3258787 (6 Block Confirmations)
    - 6 代表目前高度扣掉這個交易的區塊高度
    - 6 代表保護我們，接續的 block 是串起來的
    - 不斷不斷用電費去保護你，越多 block confirm 就越難改變你的交易紀錄

## 獎勵

區塊鏈的速度，每個區塊有總量的限制，還有挖礦也要等待

- VISA：1700筆/s
- 以太幣：7.5筆/s
- 比特幣：3筆/s

### 為什麼那麼慢？

- 礦工要挖要猜要時間
- 每個區塊能包的交易有限 (Gas Limit)
- Etherscan 看 Pending Transactions

### 礦工要先挖誰的？

- 手續費出的高
- 除了可拿原本區塊鏈的獎勵，也可拿該交易的手續費


### Etherenum 某一筆交易範例

- Mined By (就是 coinbase)
  - 地址 (名稱: Etherscan 幫他取的，常客)
- Nonce
  - 0x0005c562077ea33e
  - 0x 代表 16 進位，數字上的轉換而已
- Block Reward
  - 總共獲得的獎勵
  - 你每挖到一個區塊，blockchain 給他三顆
  - 剩下的 0.96xxx 這筆交易的手續費
  - 共 3.09 顆
- Hash
  - 0xb6d...
  - 為什麼前導 0 那麼少？
    - Etherenum 也是有 0 的，只是是做另一種計算方式，非 hash 跟難度來決定是否挖到，演算法在另外一邊並未顯示出來而已


### Bitcoin 某一筆交易範例

- Block Reward
  - 12.5 BTC
  - 2008 年發布一開始獎勵是 50 BTC
  - 每四年會減半，所以現在 12.5 顆
- Nonce
- Transactions
  - 每個區塊的第一個交易其實就是給 coinbase 的
  - No Inputs (Newly Generated Coins) -> 挖到的礦工地址
    - 手續費 + 挖到的獎勵
- Hash
  - 前導 0 就很清楚了
  - 難度越高前導 0 要的 0 就越多
  - 難度越高，數字轉換出來就越小，0 越多要轉換的數值越小

## 交易的一生

交易送出一路被挖到礦過程是怎樣？

1. 當按下發送時會開始廣播給所有節點、礦工
2. 礦工選擇要不要挖 (手續費越高越多人搶)
3. 假設要挖，礦工也順利挖到該交易
4. 該礦工會廣播該區塊，大家收到後會自行把 Pending list 拿掉

P.S. 有節點不一定是礦工，礦工也不一定會跑節點

## 難度

當初中本聰在設定比特幣的規則時，其中一個規則是，當有越來越多人投入挖礦時，讓區塊鏈越來越難挖，並隨著高度上升，增加 Hash 值的前導零。反之相反。

也就是：自動調節共識規則機制，高度多少就是調整一下就對了

### 比特幣難度計算方法

1. 判斷是否需要更新目標值
